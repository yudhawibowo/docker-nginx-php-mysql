# Mendefinisikan Versi Docker Compose
version: '3.8'

# Mendefinisikan Voulmes
volumes: 
  # Untuk Menyimpan Seluruh Data Dalam Database
  proyek1db:

# Mendefinisikan Networks
networks:
  # Untuk Mengkoneksikan Antar Services
  proyek1app:

# Mendefinisikan Services Yang Akan Dipakai
services:
  # Nama Service Untuk Web Server (nginx)
  nginx:
    # Gunakan Image Nginx Tag Alpine
    image: nginx:alpine
    # Kaitkan Folder Lokal Ke Container
    volumes: 
      # Folder Web
      - "./htdocs:/var/www"
      # Folder Konfigurasi Nginx
      - "./build/nginx/conf.d:/etc/nginx/conf.d"
      - "./build/nginx/nginx.conf:/etc/nginx/nginx.conf"
    # Ekspose Port
    ports: 
    # 80 (http://localhost)
      - "8001:80" # proyek 1
      - "443:443"
    # Jalankan Nginx Jika Service php Dan db Sudah Berjalan
    depends_on: 
      - php

    # Koneksikan Ke Network localapp
    networks: 
      - proyek1app
    
    # Tambahkan Extra Host
    extra_hosts:
        - "host.docker.internal:host-gateway"

  # Nama Service Untuk PHP
  php:
    # Build Image Dengan Dockerfile Di Folder ./.build/php
    build: ./build/php
    # Kaitkan Folder Lokal Ke Container
    volumes:
      # Jalankan PHP Di Semua Folder Web
      - "./htdocs:/var/www"
      # Folder Konfigurasi PHP 
      - "./build/php/php.ini:/usr/local/etc/php/php.ini"

    # Koneksikan Ke Network localapp
    networks: 
      - proyek1app

# Nama Service Untuk Database  
  db:
    # Gunakan Image mysql Tag latest
    image: mariadb:latest
    # Environment Yang Dibutuhkan mysql
    environment: 
      MARIADB_ROOT_PASSWORD: root
      MARIADB_PASSWORD: secret
      MARIADB_USER: homestead
    # Expose Port Agar Dapat Diakses Melalui Aplikasi MYSQL Client (phpmyadmin)
    ports: 
      - "3307:3306"
    # Simpan Semua Data Dalam Volumes localdb
    volumes: 
     - "proyek1db:/var/lib/mariadb"
    # Koneksikan Ke Network localapp
    networks: 
      - proyek1app
  
  # Nama Service Untuk PHPMYADMIN
  phpmyadmin:
    # Gunakan Image phpmyadmin
    image: phpmyadmin/phpmyadmin
    # Expose Port
    ports: 
      # Gunakan Port 8081 Untuk Mengakses phpmyadmin
      - "8081:80"
    # Koneksikan Ke Network localapp
    networks: 
      - proyek1app