server {
   listen 80;
   client_max_body_size 0;
   listen [::]:80;
   server_name inventaris.minori.co.id www.inventaris.minori.co.id; 
   return 301 https://inventaris.minori.co.id$request_uri;
}

server {

    # For https
    listen 443 ssl;
    #listen [::]:443 ssl ipv6only=on;
    ssl_certificate /etc/nginx/conf.d/ssl/inventaris.minori.co.id/certificate.crt;
    ssl_certificate_key /etc/nginx/conf.d/ssl/inventaris.minori.co.id/private.key;
    #ssl_certificate /etc/nginx/ssl/certificate_new.crt;
    #ssl_certificate_key /etc/nginx/ssl/private_new.key;

    server_name inventaris.minori.co.id www.inventaris.minori.co.id;

    # root /var/www/new-jimusho/public;
    # index index.php index.html index.htm;
    
    #mengatasi error 414 : URI to large
    large_client_header_buffers 4 32k;

    # if ($http_x_forwarded_proto != "https") {
    #     return 301 https://$host$request_uri;
    # }

    location / {
      proxy_pass http://host.docker.internal:81;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-Proto https;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_cache_bypass $http_upgrade;
      }

    location ~ /\.ht {
        deny all;
    }

    location /.well-known/acme-challenge/ {
        root /var/www/letsencrypt/;
        log_not_found off;
    }
}


# server {
#   listen 80;
#   server_name inventaris.minori.co.id;
#   return 301 https://inventaris.minori.co.id$request_uri;
# }

# server {
#     # listen 80;
#     # listen [::]:80;

#     # For https
#     listen 443 ssl;
#     #listen [::]:443 ssl ipv6only=on;
#     ssl_certificate /etc/nginx/conf.d/ssl/inventaris.minori.co.id/certificate.crt;
#     ssl_certificate_key /etc/nginx/conf.d/ssl/inventaris.minori.co.id/private.key;
#     #ssl_certificate /etc/nginx/ssl/certificate_new.crt;
#     #ssl_certificate_key /etc/nginx/ssl/private_new.key;

#     client_max_body_size 0;
#     server_name  inventaris.minori.co.id;
#     index index.php index.html;
#     error_log  /var/log/nginx/errorssl.log;
#     access_log /var/log/nginx/accessssl.log;
#     root /var/www/app-inventaris;
#     location ~ \.php$ {
#         try_files $uri =404;
#         fastcgi_split_path_info ^(.+\.php)(/.+)$;
#         fastcgi_pass php:9000;
#         fastcgi_index index.php;
#         include fastcgi_params;
#         fastcgi_read_timeout 900;
#         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#         fastcgi_param PATH_INFO $fastcgi_path_info;
#         #tambahan fastcgi_cache
#         # fastcgi_cache fcgicache;
#         # fastcgi_cache_valid 200 60m;
#         # fastcgi_cache_use_stale error timeout updating invalid_header http_500 http_503;
#         # fastcgi_cache_min_uses 1;
#         # fastcgi_cache_lock on;
#         # add_header X-FastCGI-Cache $upstream_cache_status;
#     }
#     location / {
#         try_files $uri $uri/ /index.php?$query_string;
#         gzip_static on;
#     }
# }